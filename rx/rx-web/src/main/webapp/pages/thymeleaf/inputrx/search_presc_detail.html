<!DOCTYPE html>
<th:block th:fragment="headx(title)">
<meta charset="UTF-8">
<meta name="context-path" th:content="@{/}" />
<meta  HTTP-EQUIV="nocache"   CONTENT="no-cache">

<!-- <input type="hidden" id="presc-no" th:value="${presc.rxNo}" /> -->

<!-- <div class="container-fluid"> -->
<div class="card_container" style="margin-top: 10px;">
	<h3>患者信息</h3>
	<div>
		<p style="padding-left: 50px;">
			<span> 
				<input type="hidden" id="patient-id" th:value="${patient.id}" /><!-- 患者ID -->
				<b>姓名：</b><span th:text="${patient.name}" style="padding-right: 20px">姓名</span>
				<b>性别：</b><span th:text="${patient.sex}" style="padding-right: 20px">性别</span>
				<b>年龄：</b><span th:text="${patient.old}" style="padding-right: 20px">年龄</span>
				<b>病历号：</b><span id="patient-crno" th:text="${patient.crNo}" style="padding-right: 20px">病历号</span>
				<b>登记号：</b><span th:text="${patient.rn}" style="padding-right: 20px">登记号</span>
			</span>
		</p>
	</div>
</div>
<div class="card_container diagnosis">
	<h3>疾病诊断</h3>
	<div>
		<p style="padding-left: 50px;">
			<span th:each="diagnosis,iterStat:${diagnosisList}"> <span
				th:text="${iterStat.count}+':'+${diagnosis.disease}+';'"
				style="padding-right: 20px">诊断结果</span>
			</span>
		</p>
	</div>
</div>
<div class="drug_container">
	<div class="card_container diagnosis_msg">
		<input type="hidden" id="presc-no" name="presc-no"
			th:value="${presc.rxNo}">
		<!--用于保存处方号  -->
		<h3>处方药品</h3>
		<p style="padding-left: 50px;">
			<b>处方编号：</b><span th:text="${presc.rxNo}" style="padding-right: 20px">处方编号</span>
			<b>处方创建时间：</b><span th:text="${#calendars.format(presc.createdTime,'yyyy-MM-dd HH:MM:ss')}" style="padding-right: 20px">处方创建时间</span>
			
		</p>
	</div>
	<div class="table-head">
		<table class="table table-default">
			<thead>
				<tr>
					<th class="small_width"><label for="check-select-all"><input id="check-select-all" type="checkbox">&nbsp;全选</label></th>
					<th class="small_width">药品码</th>
					<th class="input_width">药品名</th>
					<th class="middle_width">规格</th>
					<th class="small_width">单次剂量</th>
					<th class="small_width">剂量单位</th>
					<th class="middle_width">频次</th>
					<th class="middle_width">用法</th>
					<th class="small_width">疗程</th>
					<th class="small_width">数量</th>
					<th class="small_width">单位</th>
					<th class="small_width">单价</th>
					<th class="small_width">金额(￥元)</th>
				</tr>
			</thead>
		</table>
	</div>
	<div class="table-responsive" style="width:100%;">
		<div id="drugForm" class="table-body">
			<!-- <div class="dropdown-unit" style="z-index: 99;">
				<table>
					<thead>
						<tr>
							<th></th>
							<th></th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td></td>
							<td></td>
							<td></td>
						</tr>
					</tbody>
				</table>
			</div> -->
			<table
				class="drug-list table table-striped table-bordered table-default">
				<tbody id="drug-items">
					<tr th:each="prescDrug,iterStat:${prescDrugList}">
						<td class="small_width"><input type="checkbox" th:value="${prescDrug.id}"></td>
						<td class="small_width" th:text="${prescDrug.barcode}">药品码</td>
						<td class="input_width" th:text="${prescDrug.warename}">药品名</td>
						<td class="middle_width" th:text="${prescDrug.warespec}">规格</td>
						<td class="small_width" th:text="${#numbers.formatDecimal(prescDrug.dosage, 1, 2)}">单次剂量</td>
						<td class="small_width" th:text="${prescDrug.doseunit}">剂量单位</td>
						<td class="middle_width input_td" th:text="${prescDrug.drugtimes}">频次</td>
						<td class="middle_width input_td" th:text="${prescDrug.drugmode}">用法</td>
						<td class="small_width input_td" th:text="${prescDrug.days}">疗程</td>
						<td class="small_width" th:text="${prescDrug.quantity}">数量</td>
						<td class="small_width" th:text="${prescDrug.wareunit}">单位</td>
						<td class="small_width" th:text="${#numbers.formatDecimal(prescDrug.saleprice, 1, 2)}">单价</td>
						<td class="small_width" th:text="${#numbers.formatDecimal(prescDrug.saleprice*prescDrug.quantity, 1, 2)}">金额（￥元）</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
</div>
<div class="menu_container clearfix">
	<div class="left_btn pull-left" id="toolsbar">

		<button type="button" class="btn btn-info" id="btn-print">打印</button>
		<button type="button" class="btn btn-info" id="btn-preview"
			style="margin-right: 10px;">预览处方</button>
		<!-- 打印预览所绑定的按钮 -->
		<button type="button" class="btn btn-info hide"
			id="btn-print-preview">打印预览</button>

	</div>
</div>

<script th:src="@{/static/js/hospital/rxcommon.js}"
		type="text/javascript"></script>
<script th:src="@{/static/js/hospital/loadprinttemplate_search_presc.js}"
		type="text/javascript"></script>

<script th:inline="javascript">  
/*<![CDATA[*/  
  
    var g_drug_list = [[${prescDrugList}]];  
    console.log(g_drug_list);  
  
/*]]>*/  
</script>
<script>

/******************************************
 * 绑定事件-预览按钮
 *****************************************/
$('#btn-print-preview').printPreview(); // 处方预览与btn-print-preview click绑定
$("#btn-preview").on("click", function(event) {
	loadPrintTemplate(); // 加载打印模板
	//$("#btn-print-preview").trigger("click");
});

/***********************************************
 * 绑定事件-预览按钮
 ***********************************************/
$("#btn-print").on("click", function(event) {
	// $("#printarea").print(); //功能同下.
	
	var prescNo=$("#presc-no").val();
	if(prescNo!="")
		loadPrintTemplate_print();
	else{
		alert("此处方尚未保存,请先保存后再打印处方.",2000);
	}
});

/* //收集用药书指导及数量 加入到全局列表中	
g_currDrug.dosage = $("#single-dosage").val(); // 单次剂量
g_currDrug.doseunit = $("#single-dose-unit").val(); // 剂量单位
g_currDrug.drugtimes = $("#drugtimes").val(); 	// 频次
g_currDrug.drugmode = $("#drugmode").val(); 	// 给药方式(用法)
g_currDrug.days = $("#treatment-days").val(); //疗程
g_currDrug.quantity = $("#quantity").val(); 	//数量	
g_currDrug.patientid = $("#patient").attr("bind-id"); // 患者ID
g_currDrug.doctorid = $("#doctor").attr("bind-id"); // 医生ID */

</script>
								
</th:block>